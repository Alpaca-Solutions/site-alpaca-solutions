<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Usuários</title>
    <link rel="stylesheet" href="../../css/lista-usuario.css">
    <link rel="shortcut icon" href="../../assets/icon/icon_alpaca.png" type="image/x-icon">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body onload="obterDados_usuarios()">
    <div class="corpo">
        <div class="header">
            <div class="boasVindas">
                <div class="voltar">
                    <img src="../../assets/icon/seta-esquerda.png" alt="" width="25px" onclick="funcVoltar()">
                </div>
                <div class="textoBoasVindas">
                    <h3>Olá, <span id="b_usuario">usuário</span>!</h3><a href="../edits/edicao-empresa..html"><img src="../../assets/imgs/configuracoes.png" alt="" style="width: 30px;"></a>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="menu-lateral">
                <div class="opcoes">
                    <a href="../dahsboards/dashboard-geral.html"><div class="listaMenu">DASHBOARD</div></a>
                    <a href="../dahsboards/dashboard-especifico.html"><div class="listaMenu">DASH DETALHES</div></a>
                    <a href="../listas/lista-maquina.html"><div class="listaMenu">MÁQUINAS</div></a>
                    <a href="../listas/lista-usuario.html"><div class="listaMenu">USUÁRIOS</div></a>
                </div>
                <div class="sair">
                    <a href="../../index.html"><div id="leave" class="listaMenu">SAIR</div></a>
                </div>
            </div>
            <div class="grade">
                <div class="campos">
                    <div class="campos_box">
                        <a href="../cadastros/cadastro-usuario.html"><button>+ Cadastrar novo usuário</button></a>
                        <div class="listas_users">
                            <div class="titulos">
                                <div class="titulo">Nome</div>
                                <div class="titulo">Email</div>
                                <div class="titulo">Tipo de acesso</div>
                                <div class="titulo">Nível de acesso</div>
                                <div class="titulo">Editar</div>
                            </div>
                            <div class="dados">
                                <div class="linha_dados" id="linha_dados">
                                    <div class="nome" id="nome"></div>
                                    <div class="email" id="email"></div>
                                    <div class="tipo_acesso" id="tipo_acesso"></div>
                                    <div class="nivel_acesso" id="nivel_acesso"></div>
                                    <div class="acoes" id="acoes"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script>

function funcVoltar() {
    window.history.back()
}

function obterDados_usuarios() {
    var idUsuario = sessionStorage.ID_USUARIO;
    console.log("ID do Usuário:", idUsuario);

    fetch(`/avisos/listar_usuarios/${idUsuario}`, { cache: 'no-store' })
        .then(function (response) {
            if (!response.ok) {
                console.error('Erro na API:', response.status, response.statusText);
                throw new Error('Erro na API');
            }

            // Verificar se o corpo da resposta está vazio
            const contentLength = response.headers.get('content-length');
            if (contentLength && contentLength === '0') {
                console.log('Nenhum dado encontrado na resposta.');
                return null;
            }

            // Tentar analisar o corpo da resposta como JSON
            return response.json();
        })
        .then(function (resposta) {
            if (resposta !== null) {
                const containerDados = document.getElementById("linha_dados");

                // Limpar qualquer conteúdo existente
                containerDados.innerHTML = "";

                resposta.forEach(dados_banco => {
                    // Criar div para cada propriedade dos dados
                    const divNome = document.createElement("div");
                    const divEmail = document.createElement("div");
                    const divTipoAcesso = document.createElement("div");
                    const divNivelAcesso = document.createElement("div");
                    const divAcoes = document.createElement("div");

                    // Preencher os elementos div com os dados reais
                    divNome.textContent = dados_banco.nome || dados_banco.nome_fantasia;
                    divEmail.textContent = dados_banco.email;
                    divTipoAcesso.textContent = dados_banco.tipo_acesso;
                    divNivelAcesso.textContent = dados_banco.nivel_acesso;

                    // Adicionar botões ou outras ações conforme necessário
                    divAcoes.innerHTML = `<a href="../edits/edicao-usuario.html"><img src="../../assets/imgs/configuracoes.png" alt="" style="width: 30px;"></a>`;

                    // Adicionar os elementos div ao contêiner
                    containerDados.appendChild(divNome);
                    containerDados.appendChild(divEmail);
                    containerDados.appendChild(divTipoAcesso);
                    containerDados.appendChild(divNivelAcesso);
                    containerDados.appendChild(divAcoes);
                });
            }
        })
        .catch(function (error) {
            console.error(`Erro na obtenção dos dados para gráfico: ${error.message}`);
        });

    function redirectEdit() {
        for (i = 0; i <= 15; i++) {
        nome.innerHTML += `<div class="campo" id="nome${i}">instancia ${i}</div>`
        email.innerHTML += `<div class="campo" id="campo_cpu${i}">${i + i + i}%</div>`
        tipo_acesso.innerHTML += `<div class="campo" id="campo_disco${i}">${i + i}%</div>`
        nivel_acesso.innerHTML += `<div class="campo" id="campo_memoria${i}">${i + 10}%</div>`
        acoes.innerHTML += `<div class="campo" id="campo_acoes${i}"><a href="../edits/edicao-usuario.html"><img src="../../assets/imgs/configuracoes.png" alt="" style="width: 30px;"></a></div>`
        }
    }
}

</script>
</html>
